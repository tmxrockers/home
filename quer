-- Copies comments from the last report_date to today's rows (same resource_id)
WITH d AS (
  SELECT MAX(report_date) AS today_date FROM td_sp_bench_report_data
),
ld AS (
  SELECT MAX(report_date) AS last_date
  FROM td_sp_bench_report_data r
  CROSS JOIN d
  WHERE r.report_date < d.today_date
)
UPDATE td_sp_bench_report_data t
SET comments = (
  SELECT y.comments
  FROM td_sp_bench_report_data y
  CROSS JOIN ld
  WHERE y.resource_id = t.resource_id
    AND y.report_date = ld.last_date
)
WHERE t.report_date = (SELECT today_date FROM d)
  AND EXISTS (
    SELECT 1
    FROM td_sp_bench_report_data y
    CROSS JOIN ld
    WHERE y.resource_id = t.resource_id
      AND y.report_date = ld.last_date
  );